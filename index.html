<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulso Socio CChC - Compromiso PRO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            line-height: 1.6;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 6px;
            margin: 0;
        }

        .progress-fill {
            background: #4CAF50;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .content {
            padding: 40px;
        }

        .block {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .block.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .block-header {
            background: #f8f9fa;
            padding: 20px;
            margin: -40px -40px 30px -40px;
            border-left: 4px solid #4CAF50;
        }

        .block-title {
            font-size: 1.4em;
            color: #333;
            margin-bottom: 5px;
        }

        .block-subtitle {
            color: #666;
            font-size: 0.95em;
        }

        .question {
            margin-bottom: 30px;
        }

        .question-label {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .question-type {
            font-size: 0.85em;
            color: #666;
            font-style: italic;
            margin-bottom: 10px;
        }

        .options {
            margin-bottom: 10px;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option:hover {
            border-color: #4CAF50;
            background: #f8fff8;
        }

        .option.selected {
            border-color: #4CAF50;
            background: #e8f5e8;
        }

        .option input[type="radio"],
        .option input[type="checkbox"] {
            margin-right: 12px;
            width: 18px;
            height: 18px;
        }

        .text-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.2s ease;
        }

        .text-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .ranking-container {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 20px;
            min-height: 200px;
        }

        .ranking-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: move;
            transition: all 0.2s ease;
        }

        .ranking-item:hover {
            background: #e9ecef;
        }

        .ranking-item.dragging {
            opacity: 0.5;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e9ecef;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .step-indicator {
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        .completion-message {
            text-align: center;
            padding: 60px 40px;
        }

        .completion-message h2 {
            color: #4CAF50;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .completion-message p {
            font-size: 1.1em;
            color: #666;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header, .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Pulso Socio CChC</h1>
            <p>Tu visión construye el futuro. Ayúdanos a diseñar talleres hechos a la medida de tus necesidades reales.</p>
            <p><strong>Duración estimada:</strong> 12-15 minutos | <strong>Confidencial</strong></p>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="content">
            <!-- BLOQUE 1: NEGOCIO -->
            <div class="block active" id="block1">
                <div class="block-header">
                    <div class="block-title">Bloque 1: Para Entender tu Negocio</div>
                    <div class="block-subtitle">Duración estimada: 2 minutos</div>
                </div>

                <div class="question">
                    <div class="question-label">1. ¿Cuál de las siguientes opciones describe mejor la actividad principal de tu empresa?</div>
                    <div class="question-type">Pregunta de opción única</div>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q1" value="constructora">
                            <span>Constructora / Contratista General</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="inmobiliaria">
                            <span>Inmobiliaria</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="subcontratista">
                            <span>Subcontratista (ej. eléctrico, sanitario, etc.)</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="proveedor">
                            <span>Proveedor de materiales / equipos</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="consultoria">
                            <span>Consultoría / Arquitectura / Ingeniería</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="industrial">
                            <span>Industrial (fabricación de insumos)</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="otro">
                            <span>Otro</span>
                        </label>
                    </div>
                </div>

                <div class="question">
                    <div class="question-label">2. ¿En qué tipo de proyectos se concentra principalmente tu actividad?</div>
                    <div class="question-type">Pregunta de selección múltiple (hasta dos opciones)</div>
                    <div class="options">
                        <label class="option">
                            <input type="checkbox" name="q2" value="vivienda">
                            <span>Vivienda (en altura / casas)</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q2" value="vivienda_social">
                            <span>Vivienda social</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q2" value="oficinas">
                            <span>Oficinas / Comercial</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q2" value="industrial">
                            <span>Industrial / Logística</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q2" value="infraestructura">
                            <span>Infraestructura pública / Obras civiles</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q2" value="salud">
                            <span>Salud / Educación</span>
                        </label>
                    </div>
                </div>

                <!-- CHG: Pregunta 3 original dividida en 3a, 3b, 3c -->
                <div class="question">
                    <div class="question-label">3.a. ¿Aproximadamente cuántos trabajadores DIRECTOS (personal de planta) tiene tu empresa?</div>
                    <div class="question-type">Pregunta de opción única</div>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q3a" value="micro">
                            <span>Menos de 10 trabajadores</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3a" value="pequena">
                            <span>Entre 10 y 49 trabajadores</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3a" value="mediana">
                            <span>Entre 50 y 199 trabajadores</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3a" value="mediana_grande">
                            <span>Entre 200 y 499 trabajadores</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3a" value="grande">
                            <span>500 o más trabajadores</span>
                        </label>
                    </div>
                </div>
                
                <div class="question">
                    <div class="question-label">3.b. Y, en un mes promedio, ¿cuántos trabajadores INDIRECTOS (subcontratados) moviliza tu empresa?</div>
                    <div class="question-type">Pregunta de opción única</div>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q3b" value="micro">
                            <span>Menos de 10 trabajadores</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3b" value="pequena">
                            <span>Entre 10 y 49 trabajadores</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3b" value="mediana">
                            <span>Entre 50 y 199 trabajadores</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3b" value="mediana_grande">
                            <span>Entre 200 y 499 trabajadores</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3b" value="grande">
                            <span>500 o más trabajadores</span>
                        </label>
                    </div>
                </div>

                <div class="question">
                    <div class="question-label">3.c. Proyectando a 6 meses, ¿cómo esperas que varíe tu dotación total de trabajadores (directos + indirectos)?</div>
                    <div class="question-type">Pregunta de opción única</div>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q3c" value="aumenta_mucho">
                            <span>Aumentará significativamente</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3c" value="aumenta_poco">
                            <span>Aumentará ligeramente</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3c" value="mantiene">
                            <span>Se mantendrá similar</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3c" value="disminuye_poco">
                            <span>Disminuirá ligeramente</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3c" value="disminuye_mucho">
                            <span>Disminuirá significativamente</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- BLOQUE 2: DESAFÍOS -->
            <div class="block" id="block2">
                <div class="block-header">
                    <div class="block-title">Bloque 2: Tu Día a Día - Desafíos Operativos</div>
                    <div class="block-subtitle">Duración estimada: 3-4 minutos</div>
                </div>

                <div class="question">
                    <div class="question-label">4. De los siguientes desafíos, ordena los 3 que más complican el día a día de tu empresa, siendo 1 el más problemático:</div>
                    <div class="question-type">Pregunta de Ranking (arrastra para ordenar)</div>
                    <div class="ranking-container" id="rankingContainer">
                        <div class="ranking-item" draggable="true">Aumento constante en el precio de materiales</div>
                        <div class="ranking-item" draggable="true">Falta de trabajadores capacitados</div>
                        <div class="ranking-item" draggable="true">Problemas de flujo de caja y demoras en pagos</div>
                        <div class="ranking-item" draggable="true">Clientes muy exigentes o contratos rígidos</div>
                        <div class="ranking-item" draggable="true">Dificultades con subcontratistas y proveedores</div>
                        <div class="ranking-item" draggable="true">Trámites y permisos burocráticos</div>
                        <div class="ranking-item" draggable="true">Cumplir plazos y mantener productividad</div>
                        <!-- CHG: Se agregan 2 nuevas opciones al ranking -->
                        <div class="ranking-item" draggable="true">Acceso a financiamiento</div>
                        <div class="ranking-item" draggable="true">Conflictos con tus grupos de interés (comunidades, municipios, ong's)</div>
                    </div>
                </div>

                <div class="question">
                    <!-- CHG: Se reformula la pregunta 5 para abarcar los 3 desafíos -->
                    <div class="question-label">5. Respecto a los 3 desafíos principales que ordenaste, ¿podrías describir brevemente por qué son tan complejos para tu operación?</div>
                    <div class="question-type">Pregunta abierta, campo de texto</div>
                    <textarea class="text-input" name="q5" rows="4" placeholder="Ej: 'La falta de personal cualificado (1) nos retrasa las obras, y el alza de precios (2) nos obliga a renegociar contratos constantemente...'"></textarea>
                </div>
            </div>

            <!-- BLOQUE 3: FUTURO -->
            <div class="block" id="block3">
                <div class="block-header">
                    <div class="block-title">Bloque 3: Mirando Hacia Adelante - Riesgos y Oportunidades</div>
                    <div class="block-subtitle">Duración estimada: 2-3 minutos</div>
                </div>

                <div class="question">
                    <!-- CHG: Pregunta 6 convertida a Ranking y con nueva opción -->
                    <div class="question-label">6. Pensando en los próximos 2 años, ordena las siguientes tendencias del entorno según el impacto (positivo o negativo) que crees que tendrán en empresas como la tuya:</div>
                    <div class="question-type">Pregunta de Ranking (arrastra para ordenar)</div>
                    <div class="ranking-container" id="rankingContainer2">
                        <div class="ranking-item" draggable="true">La inestabilidad económica y el acceso a financiamiento</div>
                        <div class="ranking-item" draggable="true">Las nuevas exigencias normativas y medioambientales</div>
                        <div class="ranking-item" draggable="true">La capacidad de digitalizar e industrializar los procesos</div>
                        <div class="ranking-item" draggable="true">La competencia y la presión sobre los márgenes</div>
                        <div class="ranking-item" draggable="true">La capacidad para atraer y fidelizar al mejor talento</div>
                        <div class="ranking-item" draggable="true">Alza del costo de la mano de obra</div>
                    </div>
                </div>
                
                <!-- CHG: Nueva pregunta 7 intermedia -->
                <div class="question">
                    <div class="question-label">7. Sobre la tendencia que marcaste como #1, ¿la ves principalmente como un RIESGO (que podría llevar al fracaso) o como una OPORTUNIDAD (que podría impulsar el éxito) para tu empresa? ¿Por qué?</div>
                    <div class="question-type">Pregunta abierta, campo de texto corto</div>
                    <textarea class="text-input" name="q7" rows="3" placeholder="Escribe aquí tu respuesta..."></textarea>
                </div>

                <!-- CHG: Pregunta 7 original pasa a ser la 8 y se cambia "negocio" por "empresa" -->
                <div class="question">
                    <div class="question-label">8. A pesar de los desafíos, siempre hay oportunidades. ¿Dónde ves tú la veta más clara para que tu empresa crezca o se diferencie en el futuro cercano?</div>
                    <div class="question-type">Pregunta abierta, campo de texto corto</div>
                    <textarea class="text-input" name="q8" rows="3" placeholder="Escribe aquí tu respuesta..."></textarea>
                </div>
            </div>

            <!-- BLOQUE 4: INTERESES -->
            <div class="block" id="block4">
                <!-- CHG: Título del bloque actualizado -->
                <div class="block-header">
                    <div class="block-title">Bloque 4: Focos de Interés y Visión Final</div>
                    <div class="block-subtitle">Duración estimada: 3-4 minutos</div>
                </div>

                <div class="question">
                    <div class="question-label">9. Para potenciar tu empresa, nos interesa saber en qué áreas te gustaría adquirir nuevas herramientas o conocimientos. Marca todas las que te parezcan relevantes.</div>
                    <div class="question-type">Pregunta de selección múltiple</div>
                    <div class="options">
                        <label class="option">
                            <input type="checkbox" name="q9" value="estrategia">
                            <span>Estrategia de Negocio y Nuevas Oportunidades de Mercado</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q9" value="finanzas">
                            <span>Gestión Financiera (control de costos, flujo de caja, financiamiento)</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q9" value="liderazgo">
                            <span>Liderazgo y Gestión de Equipos</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q9" value="trabajadores">
                            <span>Encontrar y Mantener Buenos Trabajadores</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q9" value="capacitacion">
                            <span>Capacitación del Personal (oficios, nuevas técnicas, certificaciones)</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q9" value="clima">
                            <span>Clima Laboral y Motivación del Equipo</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q9" value="seguridad">
                            <span>Prevención de Accidentes y Seguridad</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q9" value="tecnologia">
                            <span>Tecnología para Mejorar el Trabajo (software, herramientas digitales)</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q9" value="negociacion">
                            <span>Negociación con Clientes y Manejo de Contratos</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q9" value="proveedores">
                            <span>Problemas con Proveedores y Materiales (disponibilidad, precios, calidad)</span>
                        </label>
                        <!-- CHG: Opción "Comunidad y Vecinos" reemplazada -->
                        <label class="option">
                            <input type="checkbox" name="q9" value="grupos_interes">
                            <span>Relación con grupos de interés (comunidades, municipios, ong's)</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q9" value="ambiente">
                            <span>Temas Ambientales (residuos, permisos, eficiencia)</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q9" value="diferenciacion">
                            <span>Diferenciarse de la Competencia (qué nos hace únicos)</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="q9" value="normativas">
                            <span>Cumplir con Normativas y Fiscalizaciones</span>
                        </label>
                    </div>
                </div>

                <div class="question">
                    <div class="question-label">10. De todas las que marcaste, si tuvieras que elegir UNA SOLA área para un taller práctico el próximo mes, ¿cuál sería la que te generaría un impacto más inmediato?</div>
                    <div class="question-type">Pregunta de opción única (basada en respuestas anteriores)</div>
                    <div class="options" id="q10Options">
                        <!-- Se poblará dinámicamente -->
                    </div>
                </div>

                <div class="question">
                    <div class="question-label">11. Respecto a esa área prioritaria que elegiste, ¿qué problema específico te gustaría resolver o qué habilidad concreta te gustaría aprender?</div>
                    <div class="question-type">Pregunta abierta, campo de texto corto</div>
                    <textarea class="text-input" name="q11" rows="3" placeholder="Escribe aquí tu respuesta..."></textarea>
                </div>

                <div class="question">
                    <div class="question-label">12. ¿Hay algún otro desafío o tema importante para tu empresa que no hayamos mencionado? (Opcional)</div>
                    <div class="question-type">Pregunta abierta, campo de texto corto (opcional)</div>
                    <textarea class="text-input" name="q12" rows="3" placeholder="Escribe aquí tu respuesta..."></textarea>
                </div>

                <!-- CHG: Pregunta 13 (antes 12 del bloque 5) movida aquí como pregunta final -->
                 <div class="question">
                    <div class="question-label">13. Por último, cuando escuchas 'empresa sostenible', ¿qué es lo primero que te viene a la mente?</div>
                    <div class="question-type">Pregunta abierta, campo de texto corto</div>
                    <textarea class="text-input" name="q13" rows="3" placeholder="Escribe aquí tu respuesta..."></textarea>
                </div>
            </div>

            <!-- CHG: Bloque 5 completamente eliminado -->

            <!-- PÁGINA DE COMPLETADO -->
            <div class="block" id="completion">
                <div class="completion-message">
                    <h2>¡Gracias por tu participación! 🎉</h2>
                    <p>Tus respuestas son muy valiosas para nosotros. Utilizaremos esta información para diseñar talleres y cursos que respondan a las necesidades reales de los socios de la CChC.</p>
                    <br>
                    <p><strong>Te mantendremos informado sobre los próximos talleres diseñados especialmente para ti.</strong></p>
                    <br>
                    <p style="font-size: 0.9em; color: #888;">Equipo Compromiso PRO - CChC</p>
                </div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousBlock()">← Anterior</button>
                <div class="step-indicator" id="stepIndicator">Bloque 1 de 4</div>
                <button class="btn btn-primary" id="nextBtn" onclick="nextBlock()">Siguiente →</button>
            </div>
        </div>
    </div>

    <script>
        let currentBlock = 1;
        // CHG: Se actualiza el número total de bloques de 5 a 4
        const totalBlocks = 4;

        // Configurar drag and drop para ranking
        setupDragAndDrop();

        // Configurar validación dinámica para q10 (antes q9)
        setupDynamicQ10();

        function updateProgress() {
            const progress = ((currentBlock - 1) / totalBlocks) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function updateStepIndicator() {
            const indicator = document.getElementById('stepIndicator');
            if (currentBlock <= totalBlocks) {
                indicator.textContent = `Bloque ${currentBlock} de ${totalBlocks}`;
            } else {
                indicator.textContent = 'Completado';
            }
        }

        function showBlock(blockNumber) {
            // Ocultar todos los bloques
            const blocks = document.querySelectorAll('.block');
            blocks.forEach(block => block.classList.remove('active'));

            // Mostrar el bloque actual
            if (blockNumber <= totalBlocks) {
                document.getElementById(`block${blockNumber}`).classList.add('active');
            } else {
                document.getElementById('completion').classList.add('active');
            }

            // Actualizar navegación
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.style.display = blockNumber > 1 ? 'block' : 'none';
            
            if (blockNumber > totalBlocks) {
                nextBtn.style.display = 'none';
                // Ocultar el botón de retroceso y el indicador en la pantalla final
                prevBtn.style.display = 'none';
                document.getElementById('stepIndicator').style.display = 'none';
            } else if (blockNumber === totalBlocks) {
                nextBtn.textContent = 'Finalizar →';
                nextBtn.style.display = 'block';
                document.getElementById('stepIndicator').style.display = 'block';
            } else {
                nextBtn.textContent = 'Siguiente →';
                nextBtn.style.display = 'block';
                document.getElementById('stepIndicator').style.display = 'block';
            }

            updateProgress();
            updateStepIndicator();
        }

        function nextBlock() {
            if (validateCurrentBlock()) {
                currentBlock++;
                showBlock(currentBlock);
            }
        }

        function previousBlock() {
            if (currentBlock > 1) {
                currentBlock--;
                showBlock(currentBlock);
            }
        }

        function validateCurrentBlock() {
            // Aquí iría la lógica de validación por bloque
            return true;
        }

        // CHG: Función de drag and drop mejorada para soportar múltiples contenedores de ranking
        function setupDragAndDrop() {
            const containers = document.querySelectorAll('.ranking-container');
            containers.forEach(container => {
                const items = container.querySelectorAll('.ranking-item');
                items.forEach(item => {
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragover', handleDragOver);
                    item.addEventListener('drop', handleDrop);
                    item.addEventListener('dragend', handleDragEnd);
                });
            });
        }
        
        // CHG: variable global para el elemento arrastrado
        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = e.target; // CHG: Guardar la referencia
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            // CHG: No es necesario transferir el HTML, la referencia es suficiente y más limpia
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            const dropTarget = e.target.closest('.ranking-item');
            
            if (dropTarget && draggedElement !== dropTarget) {
                const container = dropTarget.parentElement;
                // CHG: Lógica de reordenamiento mejorada
                const rect = dropTarget.getBoundingClientRect();
                const offsetY = e.clientY - rect.top;
                
                if (offsetY > rect.height / 2) {
                    container.insertBefore(draggedElement, dropTarget.nextSibling);
                } else {
                    container.insertBefore(draggedElement, dropTarget);
                }
            }
        }

        function handleDragEnd(e) {
             if (draggedElement) {
                draggedElement.classList.remove('dragging');
                draggedElement = null; // CHG: Limpiar la referencia
            }
        }
        
        // CHG: Se actualiza la función para apuntar a los nuevos nombres/IDs de preguntas (q9 -> q10)
        function setupDynamicQ10() {
            const q9Checkboxes = document.querySelectorAll('input[name="q9"]');
            const q10Options = document.getElementById('q10Options');
            
            q9Checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // Limpiar opciones previas
                    q10Options.innerHTML = '';
                    
                    // Agregar solo las opciones seleccionadas
                    const selectedOptions = document.querySelectorAll('input[name="q9"]:checked');
                    selectedOptions.forEach(option => {
                        const label = option.parentElement.querySelector('span').textContent;
                        const optionHtml = `
                            <label class="option">
                                <input type="radio" name="q10" value="${option.value}">
                                <span>${label}</span>
                            </label>
                        `;
                        q10Options.innerHTML += optionHtml;
                    });
                });
            });
        }

        // Agregar interactividad a las opciones
        document.addEventListener('change', function(e) {
            if (e.target.type === 'radio' || e.target.type === 'checkbox') {
                const optionLabel = e.target.closest('.option');
                if (!optionLabel) return;

                if (e.target.type === 'radio') {
                    // Remover selección previa para radio buttons dentro del mismo contenedor de opciones
                    const parentOptions = optionLabel.parentElement;
                    const siblings = parentOptions.querySelectorAll('.option');
                    siblings.forEach(sibling => sibling.classList.remove('selected'));
                }
                
                if (e.target.checked) {
                    optionLabel.classList.add('selected');
                } else {
                    optionLabel.classList.remove('selected');
                }
            }
        });

        // Inicializar
        showBlock(1);
    </script>
</body>
</html>
